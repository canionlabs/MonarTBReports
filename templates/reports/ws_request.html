<!DOCTYPE HTML>
<html>
<head>

    <script type="text/javascript">
        function WebSocketAPIExample() {
            var token = "{{ tb_context }}";
            var entityId = "{{ device_id }}";
            var webSocket = new WebSocket("ws://platform.canionlabs.io:9090/api/ws/plugins/telemetry?token="+token);

            webSocket.onopen = function () {
                var object = {
                    tsSubCmds: [
                      {
                          cmdId: 1,
                          entityType: "DEVICE",
                          entityId: entityId,
                      }
                    ],
                    historyCmds: [
                      {
                          cmdId: 1,
                          entityType: "DEVICE",
                          entityId: entityId,
                          keys: "t0",
                          startTs: "{{ startTs }}",
                          endTs: "{{ endTs }}"
                      }
                    ],
                    attrSubCmds: []
                };
                var data = JSON.stringify(object);
                webSocket.send(data);
                console.log("Message is sent: " + data);
            };

            webSocket.onmessage = function (event) {
                var received_msg = event.data;
                console.log(received_msg);
            };

            webSocket.onclose = function (event) {
                console.log("Connection is closed!");
            };
        }
    </script>

</head>
<body>

<div id="sse">
    <a href="javascript:WebSocketAPIExample()">Run WebSocket</a>
</div>

</body>
</html>
